<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»å‹•åŸ·è¡Œå¿«æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        .btn-toggle { transition: all 0.2s; border: 2px solid #1d4ed8; }
        .btn-active { background: #1d4ed8 !important; color: white !important; }
        table { width: 100%; border-collapse: collapse; border: 2px solid #333; background: white; }
        th, td { border: 1px solid #333; padding: 12px; }
        /* çª„ç‰ˆç°½åˆ°å¡ */
        .vip-box { max-width: 450px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; border-left: 6px solid #cbd5e1; margin-bottom: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card.signed { border-left-color: #22c55e; background: #f0fdf4; }
    </style>
</head>
<body class="p-2 md:p-6">

    <div class="max-w-[1000px] mx-auto">
        <div class="flex gap-1 mb-4 bg-white p-1 rounded-xl shadow-md border border-gray-200">
            <button id="btn1" onclick="switchTab(1)" class="btn-toggle btn-active flex-1 py-4 rounded-lg font-black text-blue-700 bg-white">
                ğŸ“„ æŸ¥çœ‹æµç¨‹å¤§è¡¨
            </button>
            <button id="btn2" onclick="switchTab(2)" class="btn-toggle flex-1 py-4 rounded-lg font-black text-blue-700 bg-white">
                ğŸ™ï¸ é€²å…¥é•·å®˜ç°½åˆ°
            </button>
        </div>

        <div id="panel1" class="tab-panel active bg-white p-4 rounded-xl shadow-lg">
            <h2 class="text-xl font-black mb-4 border-b-2 border-blue-500 pb-2">è¨˜è€…æœƒæµç¨‹å¤§è¡¨</h2>
            <table>
                <tr class="bg-gray-200">
                    <th class="w-24">æ™‚é–“</th><th>å–®å…ƒ</th><th>åˆ†å·¥</th><th>å…§å®¹é‡é»</th>
                </tr>
                <tr>
                    <td class="text-center font-mono font-bold">09:40</td>
                    <td class="font-bold text-blue-700">é•·å®˜ç°½åˆ°</td>
                    <td><select class="p-1 border rounded w-full"><option>å ´æ§</option></select></td>
                    <td contenteditable="true" class="text-sm">å¼•å°é•·å®˜å…¥å¸­ã€æä¾›ç¤¦æ³‰æ°´</td>
                </tr>
            </table>
        </div>

        <div id="panel2" class="tab-panel">
            <div class="vip-box">
                <div class="flex gap-2 mb-4">
                    <select id="unitSelect" class="flex-1 p-3 rounded-lg border-2 border-blue-500 font-bold">
                        <option value="é ­ä»½å¸‚å…¬æ‰€">é ­ä»½å¸‚å…¬æ‰€</option>
                        <option value="è‹—æ —ç¸£æ”¿åºœ">è‹—æ —ç¸£æ”¿åºœ</option>
                    </select>
                    <button onclick="loadData()" class="bg-blue-600 text-white px-6 rounded-lg font-bold shadow-lg">é€£ç·š</button>
                </div>

                <div id="displayArea">
                    <div class="bg-blue-50 p-10 rounded-xl border-2 border-dashed border-blue-300 text-center">
                        <p class="text-blue-700 mb-6 font-bold">å°šæœªé€£ç·šè‡³é›²ç«¯è³‡æ–™åº«</p>
                        <button onclick="loadData()" class="bg-blue-600 hover:bg-blue-700 text-white py-4 px-10 rounded-full font-black shadow-xl text-lg transition-transform active:scale-95">
                            âš¡ ç«‹å³æŒ‰æ­¤é€£ç·š
                        </button>
                        <p class="text-xs text-gray-400 mt-6">è‹¥å¤šæ¬¡é€£ç·šå¤±æ•—ï¼Œè«‹é»æ“Šä¸‹æ–¹</p>
                        <a href="ä½ çš„GASåŸ·è¡Œç¶²å€" target="_blank" class="text-blue-500 underline text-xs">å¼·åˆ¶é–‹å•Ÿå…¨è¢å¹•ç°½åˆ°é é¢</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GAS_URL = "ä½ çš„GASåŸ·è¡Œç¶²å€";

        // åˆ‡æ›æŒ‰éˆ•é‚è¼¯
        function switchTab(n) {
            document.getElementById('panel1').classList.toggle('active', n === 1);
            document.getElementById('panel2').classList.toggle('active', n === 2);
            document.getElementById('btn1').className = n === 1 ? 'btn-toggle btn-active flex-1 py-4 rounded-lg font-black' : 'btn-toggle flex-1 py-4 rounded-lg font-black text-blue-700 bg-white';
            document.getElementById('btn2').className = n === 2 ? 'btn-toggle btn-active flex-1 py-4 rounded-lg font-black' : 'btn-toggle flex-1 py-4 rounded-lg font-black text-blue-700 bg-white';
        }

        // è®€å–è³‡æ–™é‚è¼¯
        async function loadData() {
            const container = document.getElementById('displayArea');
            const unit = document.getElementById('unitSelect').value;
            container.innerHTML = '<div class="text-center py-20 font-bold animate-pulse">ğŸ“¡ æ­£åœ¨é€£ç·šé›²ç«¯åå–®...</div>';

            try {
                const res = await fetch(`${GAS_URL}?action=fetch&unit=${encodeURIComponent(unit)}`);
                const data = await res.json();
                renderCards(data);
            } catch (e) {
                container.innerHTML = `
                    <div class="bg-red-50 p-6 rounded-xl border-2 border-red-200 text-center">
                        <p class="text-red-600 font-bold mb-4">API é€£ç·šè¢«é˜»æ“‹</p>
                        <a href="${GAS_URL}" target="_blank" class="block bg-blue-600 text-white py-4 rounded-lg font-black shadow-lg">
                            ç›´æ¥é–‹å•ŸåŸæœ¬ç°½åˆ°ç³»çµ±
                        </a>
                    </div>`;
            }
        }

        function renderCards(vips) {
            const container = document.getElementById('displayArea');
            container.innerHTML = vips.map(vip => `
                <div class="card ${vip.status ? 'signed' : ''}">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-[10px] text-gray-400 block">${vip.title || 'è²´è³“'}</span>
                            <span class="text-xl font-black">${vip.name}</span>
                        </div>
                        <button onclick="update('${vip.rowIdx}', ${!vip.status})" class="px-6 py-2 rounded-md font-bold text-sm ${vip.status ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-500'}">
                            ${vip.status ? 'å·²ç°½åˆ°' : 'æœªç°½åˆ°'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function update(row, val) {
            const unit = document.getElementById('unitSelect').value;
            // æŒ‡ä»¤ï¼šaction=update, col=1(Aæ¬„)
            fetch(`${GAS_URL}?action=update&unit=${encodeURIComponent(unit)}&row=${row + 2}&col=1&val=${val}`, {mode: 'no-cors'});
            setTimeout(loadData, 500);
        }
    </script>
</body>
</html>
