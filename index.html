<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ´»å‹•åŸ·è¡Œå°å¹«æ‰‹ - å°ˆæ¥­åŸ·è¡Œç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f1f5f9; }
        .input-underline { border: none; border-bottom: 1px solid black; outline: none; background: transparent; }
        table { border-collapse: collapse; width: 100%; border: 2px solid black; }
        th, td { border: 1.5px solid black; padding: 10px; }
        .bg-gray-header { background-color: #e5e7eb; }
        .tab-active { border-bottom: 4px solid #1d4ed8; color: #1d4ed8; font-weight: bold; background: white; }
        .vip-card { background: white; border-radius: 8px; padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 6px solid #cbd5e1; }
        .vip-card.arrived { border-left-color: #22c55e; }
        .vip-card.introduced { background-color: #f0fdf4; opacity: 0.8; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-[1200px] mx-auto">
        <div class="flex bg-gray-200 rounded-t-xl overflow-hidden mb-1">
            <div id="t1" onclick="showTab(1)" class="flex-1 py-4 text-center cursor-pointer tab-active">ğŸ“„ 1. æµç¨‹å¤§è¡¨</div>
            <div id="t2" onclick="showTab(2)" class="flex-1 py-4 text-center cursor-pointer">ğŸ™ï¸ 2. é•·å®˜ç°½åˆ° (API)</div>
        </div>

        <div class="bg-white p-6 shadow-xl border border-gray-200 rounded-b-xl min-h-[85vh]">
            
            <div id="tab1">
                <div class="mb-6 font-bold">ä¸»é¡Œï¼š<input type="text" class="input-underline w-64"></div>
                <table>
                    <tr class="bg-gray-header"><th>æ™‚é–“</th><th>å–®å…ƒ</th><th>åˆ†å·¥</th><th>å·¥ä½œå…§å®¹</th></tr>
                    <tr><td class="text-center">09:40</td><td class="font-bold">é•·å®˜ç°½åˆ°</td><td><select><option>å ´æ§</option></select></td><td></td></tr>
                </table>
            </div>

            <div id="tab2" class="hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <div class="flex items-center gap-2">
                        <span class="font-bold">åˆ‡æ›å–®ä½ï¼š</span>
                        <select id="unitSelect" onchange="changeUnit()" class="border p-2 rounded">
                            <option value="é ­ä»½å¸‚å…¬æ‰€">é ­ä»½å¸‚å…¬æ‰€</option>
                            <option value="è‹—æ —ç¸£æ”¿åºœ">è‹—æ —ç¸£æ”¿åºœ</option>
                        </select>
                    </div>
                    <button onclick="loadVips()" class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold shadow">ğŸ”„ åˆ·æ–°ç‹€æ…‹</button>
                </div>
                
                <div id="vipList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbywZhLohhe44f30HS5MADBgQEMpiuZOemHGsbQsPkM0n7a6cF0RbnN3bn4-WNaNGtmqyw/exec";

        function showTab(n) {
            document.getElementById('tab1').classList.toggle('hidden', n!==1);
            document.getElementById('tab2').classList.toggle('hidden', n!==2);
            document.getElementById('t1').classList.toggle('tab-active', n===1);
            document.getElementById('t2').classList.toggle('tab-active', n===2);
            if(n===2) loadVips();
        }

        async function loadVips() {
            const unit = document.getElementById('unitSelect').value;
            const container = document.getElementById('vipList');
            container.innerHTML = '<div class="col-span-full text-center">é€£ç·šä¸­...</div>';
            
            try {
                const res = await fetch(`${GAS_URL}?action=getData&unit=${encodeURIComponent(unit)}`);
                const vips = await res.json();
                renderVips(vips);
            } catch (e) {
                container.innerHTML = '<div class="col-span-full text-red-500 text-center">é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ GAS éƒ¨ç½²æ¬Šé™ã€‚</div>';
            }
        }

        function renderVips(vips) {
            const container = document.getElementById('vipList');
            container.innerHTML = vips.map(vip => `
                <div class="vip-card ${vip.status ? 'arrived' : ''} ${vip.isIntroduced ? 'introduced' : ''}">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="text-sm font-bold text-slate-800">${vip.title || 'è²´è³“'}</div>
                            <div class="text-xl font-black">${vip.name}</div>
                        </div>
                        <div class="text-xs font-mono bg-gray-100 px-2 rounded">é †åº:${vip.order || '-'}</div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="update('${vip.rowIdx}', 'status', ${!vip.status})" 
                                class="flex-1 py-1 rounded text-sm font-bold ${vip.status ? 'bg-green-600 text-white' : 'bg-slate-200'}">
                            ${vip.status ? 'å·²ç°½åˆ°' : 'ç°½åˆ°'}
                        </button>
                        <button onclick="update('${vip.rowIdx}', 'introduced', ${!vip.isIntroduced})" 
                                class="flex-1 py-1 rounded text-sm font-bold ${vip.isIntroduced ? 'bg-blue-600 text-white' : 'bg-slate-200'}">
                            ${vip.isIntroduced ? 'å·²ä»‹ç´¹' : 'ä»‹ç´¹'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function update(rowIdx, type, val) {
            const unit = document.getElementById('unitSelect').value;
            // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼é€æŒ‡ä»¤ä»¥é¿å… CORS å ±éŒ¯
            fetch(`${GAS_URL}?action=update&unit=${encodeURIComponent(unit)}&rowIdx=${rowIdx}&type=${type}&val=${val}`, {mode: 'no-cors'});
            
            // ç‚ºäº†æµæš¢åº¦ï¼Œæˆ‘å€‘å…ˆåœ¨ç•«é¢ä¸Šå‡æ›´æ–°ï¼Œä¸ç”¨ç­‰ä¼ºæœå™¨å›å‚³
            setTimeout(loadVips, 500);
        }

        function changeUnit() {
            const unit = document.getElementById('unitSelect').value;
            fetch(`${GAS_URL}?action=update&type=unit&val=${encodeURIComponent(unit)}`, {mode: 'no-cors'});
            loadVips();
        }
    </script>
</body>
</html>
