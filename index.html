<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動執行大表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f8fafc; }
        .rundown-table { width: 100%; border-collapse: collapse; border: 2px solid black; background: white; }
        .rundown-table th, .rundown-table td { border: 1.5px solid black; padding: 8px; }
        .bg-gray-header { background-color: #f3f4f6; }
        .input-line { border: none; border-bottom: 1px solid black; outline: none; padding: 0 4px; background: transparent; }
        select { background: transparent; outline: none; width: 100%; cursor: pointer; }
        .time-auto { background-color: #f9fafb; color: #1d4ed8; font-weight: bold; text-align: center; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-[1200px] mx-auto">
        
        <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-6 flex flex-wrap gap-6 items-center font-bold">
            <div class="flex items-center">主題：<input type="text" class="input-line w-48" value="記者會"></div>
            <div class="flex items-center">日期：<input type="date" class="input-line"></div>
            <div class="flex items-center">地點：<input type="text" class="input-line w-40"></div>
            <div class="flex items-center">
                主持人：
                <select class="input-line w-32 ml-1" onchange="checkManual(this)">
                    <option value="Yin">Yin</option>
                    <option value="小巫">小巫</option>
                    <option value="Peter">Peter</option>
                    <option value="小柔">小柔</option>
                    <option value="manual">手動輸入...</option>
                </select>
            </div>
        </div>

        <div class="flex gap-2 mb-4">
            <div class="flex-1 py-4 rounded-xl font-black text-xl bg-blue-700 text-white shadow-md text-center">
                流程表
            </div>
            <div class="flex-1 py-4 rounded-xl font-black text-xl bg-gray-200 text-gray-500 shadow-sm text-center cursor-not-allowed">
                長官簽到 (暫停使用)
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
            <div class="flex justify-between items-center mb-4">
                <p class="text-sm text-blue-600 font-bold">※ 只要輸入第一列的「開始時間」與各列「長度」，系統會自動計算後續時間。</p>
                <button onclick="addRow()" class="bg-green-600 text-white px-8 py-2 rounded-lg font-bold hover:bg-green-700 shadow-md transition-all">
                    + 新增行列
                </button>
            </div>

            <table id="rundownTable" class="rundown-table">
                <thead>
                    <tr class="bg-gray-header">
                        <th class="w-28">開始時間</th>
                        <th class="w-24">長度(min)</th>
                        <th>單元項目</th>
                        <th class="w-32">分工</th>
                        <th class="w-32">人員</th>
                        <th>重點工作內容</th>
                        <th class="w-16">操作</th>
                    </tr>
                </thead>
                <tbody id="rundownBody">
                    <tr>
                        <td class="text-center"><input type="time" class="start-time text-center font-bold w-full" value="09:00" oninput="calculateAllTimes()"></td>
                        <td class="text-center"><input type="number" class="duration text-center w-full" value="10" oninput="calculateAllTimes()"></td>
                        <td contenteditable="true" class="font-bold">活動準備與場整</td>
                        <td>
                            <select onchange="checkManual(this)">
                                <option>控場</option><option>音響</option><option>主持人</option><option>遞mic</option><option>上手板</option><option>上道具</option><option value="manual">手動輸入</option>
                            </select>
                        </td>
                        <td>
                            <select onchange="checkManual(this)">
                                <option>鐵仁</option><option>柏緯</option><option>江哥</option><option>瑩驊</option><option>露比</option><option>芳瑜</option><option>崧瑋</option><option>工讀1</option><option>工讀2</option><option value="manual">手動輸入</option>
                            </select>
                        </td>
                        <td contenteditable="true" class="text-sm">確認物資、音響測試</td>
                        <td class="text-center"><button onclick="deleteRow(this)" class="text-red-500 font-bold">✕</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 自動新增行列
        function addRow() {
            const tbody = document.getElementById("rundownBody");
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td class="time-auto">--:--</td>
                <td class="text-center"><input type="number" class="duration text-center w-full" value="5" oninput="calculateAllTimes()"></td>
                <td contenteditable="true">新單元項目</td>
                <td>
                    <select onchange="checkManual(this)">
                        <option>控場</option><option>音響</option><option>主持人</option><option>遞mic</option><option>上手板</option><option>上道具</option><option value="manual">手動輸入</option>
                    </select>
                </td>
                <td>
                    <select onchange="checkManual(this)">
                        <option>鐵仁</option><option>柏緯</option><option>江哥</option><option>瑩驊</option><option>露比</option><option>芳瑜</option><option>崧瑋</option><option>工讀1</option><option>工讀2</option><option value="manual">手動輸入</option>
                    </select>
                </td>
                <td contenteditable="true" class="text-sm">內容詳述...</td>
                <td class="text-center"><button onclick="deleteRow(this)" class="text-red-500 font-bold">✕</button></td>
            `;
            tbody.appendChild(tr);
            calculateAllTimes();
        }

        // 核心邏輯：自動計算時間
        function calculateAllTimes() {
            const rows = document.querySelectorAll("#rundownBody tr");
            let currentTime = "";

            rows.forEach((row, index) => {
                const durationInput = row.querySelector(".duration");
                const duration = parseInt(durationInput.value) || 0;

                if (index === 0) {
                    // 第一列：取手動輸入的時間
                    currentTime = row.querySelector(".start-time").value;
                } else {
                    // 後續列：顯示計算後的開始時間
                    row.querySelector(".time-auto").innerText = currentTime;
                }

                // 計算下一列的起始時間
                if (currentTime) {
                    let [hours, minutes] = currentTime.split(":").map(Number);
                    minutes += duration;
                    while (minutes >= 60) {
                        minutes -= 60;
                        hours = (hours + 1) % 24;
                    }
                    currentTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                }
            });
        }

        // 刪除列
        function deleteRow(btn) {
            btn.closest("tr").remove();
            calculateAllTimes();
        }

        // 處理手動輸入選項
        function checkManual(select) {
            if (select.value === "manual") {
                const val = prompt("請輸入自定義內容：");
                if (val) {
                    const option = document.createElement("option");
                    option.value = val;
                    option.text = val;
                    select.add(option, select[0]);
                    select.value = val;
                } else {
                    select.selectedIndex = 0;
                }
            }
        }

        // 初始化計算
        window.onload = calculateAllTimes;
    </script>
</body>
</html>
