<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»å‹•åŸ·è¡Œç³»çµ± - å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f1f5f9; }
        .input-underline { border: none; border-bottom: 1px solid black; outline: none; background: transparent; }
        table { border-collapse: collapse; width: 100%; border: 2px solid black; }
        th, td { border: 1.5px solid black; padding: 10px; }
        .tab-active { border-bottom: 4px solid #1d4ed8; color: #1d4ed8; font-weight: bold; background: white; }
        /* ä»¿ GAS ç‰ˆé¢ï¼šçª„ç‰ˆè¨­è¨ˆ */
        .vip-container { max-width: 450px; margin: 0 auto; }
        .vip-card { background: white; border: 1px solid #e2e8f0; border-left: 6px solid #94a3b8; border-radius: 6px; margin-bottom: 10px; padding: 12px; }
        .vip-card.signed { border-left-color: #22c55e; background-color: #f0fdf4; }
        .hidden { display: none; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-[1200px] mx-auto">
        <div class="flex bg-gray-200 rounded-t-xl overflow-hidden mb-1">
            <div id="t1" onclick="showTab(1)" class="flex-1 py-4 text-center cursor-pointer tab-active">ğŸ“„ æµç¨‹å¤§è¡¨</div>
            <div id="t2" onclick="showTab(2)" class="flex-1 py-4 text-center cursor-pointer">ğŸ™ï¸ é•·å®˜ç°½åˆ° (é›²ç«¯åŒæ­¥)</div>
        </div>

        <div class="bg-white p-6 shadow-xl border border-gray-200 rounded-b-xl min-h-[85vh]">
            
            <div id="tab1">
                <div class="mb-6 font-bold text-lg border-b pb-4">
                    è¨˜è€…æœƒä¸»é¡Œï¼š<input type="text" class="input-underline w-64">
                    ä¸»æŒäººï¼š<input type="text" class="input-underline w-32 ml-4">
                </div>
                <table>
                    <tr class="bg-gray-100">
                        <th>æ™‚é–“</th><th>å–®å…ƒ</th><th>åˆ†å·¥</th><th>å·¥ä½œå…§å®¹</th>
                    </tr>
                    <tr>
                        <td class="text-center">09:40</td>
                        <td class="font-bold">é•·å®˜åˆ°å ´ç°½åˆ°</td>
                        <td><select class="w-full border p-1"><option>å ´æ§</option><option>åŸ·è¡Œ1</option></select></td>
                        <td contenteditable="true">ç¢ºèªç°½åˆ°è¡¨èˆ‡ç“¶æ°´</td>
                    </tr>
                </table>
            </div>

            <div id="tab2" class="hidden">
                <div class="vip-container">
                    <div class="flex gap-2 mb-6">
                        <select id="unitSelect" onchange="loadVips()" class="flex-1 border p-2 rounded font-bold shadow-sm">
                            <option value="é ­ä»½å¸‚å…¬æ‰€">é ­ä»½å¸‚å…¬æ‰€</option>
                            <option value="è‹—æ —ç¸£æ”¿åºœ">è‹—æ —ç¸£æ”¿åºœ</option>
                        </select>
                        <button onclick="loadVips()" class="bg-slate-700 text-white px-4 py-2 rounded">ğŸ”„</button>
                    </div>
                    <div id="vipList" class="space-y-2">
                        <p class="text-center text-gray-400 py-10">è³‡æ–™åŒæ­¥ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è«‹å¡«å…¥æ‚¨çš„ GAS åŸ·è¡Œç¶²å€
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyKe0EVXuPva48B_ocPMpJBRjG-kLbyhDf4eeofN5Mnq060Mb60OucBXtLRqxK2ON6w9Q/exec";

        function showTab(n) {
            document.getElementById('tab1').classList.toggle('hidden', n !== 1);
            document.getElementById('tab2').classList.toggle('hidden', n !== 2);
            document.getElementById('t1').classList.toggle('tab-active', n === 1);
            document.getElementById('t2').classList.toggle('tab-active', n === 2);
            if (n === 2) loadVips();
        }

        async function loadVips() {
            const unit = document.getElementById('unitSelect').value;
            const container = document.getElementById('vipList');
            try {
                const res = await fetch(`${GAS_URL}?action=fetch&unit=${encodeURIComponent(unit)}`);
                const data = await res.json();
                renderVips(data);
            } catch (e) {
                container.innerHTML = '<p class="text-center text-red-500">è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª GAS éƒ¨ç½²æ¬Šé™è¨­å®šç‚ºã€Œä»»ä½•äººã€ã€‚</p>';
            }
        }

        function renderVips(vips) {
            const container = document.getElementById('vipList');
            container.innerHTML = vips.map(vip => `
                <div class="vip-card ${vip.status === true ? 'signed' : ''}">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-[10px] text-gray-400 font-bold">${vip.title || 'è²´è³“'}</div>
                            <div class="text-lg font-black">${vip.name}</div>
                        </div>
                        <div class="flex flex-col gap-1">
                            <button onclick="runGasUpdate('updateStatus', '${vip.rowIdx}', ${!vip.status})" 
                                class="text-xs px-3 py-1 rounded border font-bold ${vip.status === true ? 'bg-green-600 text-white' : 'bg-white text-slate-600'}">
                                ${vip.status === true ? 'å·²å…¥å¸­' : 'ç°½åˆ°'}
                            </button>
                            <button onclick="runGasUpdate('updateIntroduced', '${vip.rowIdx}', ${!vip.isIntroduced})" 
                                class="text-xs px-3 py-1 rounded border font-bold ${vip.isIntroduced === true ? 'bg-blue-600 text-white' : 'bg-white text-slate-600'}">
                                ${vip.isIntroduced === true ? 'å·²ä»‹ç´¹' : 'æœªä»‹ç´¹'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // é ç«¯åŸ·è¡Œæ‚¨çš„ GAS å‡½å¼
        function runGasUpdate(funcName, rowIdx, val) {
            const unit = document.getElementById('unitSelect').value;
            // é€é no-cors ç™¼é€ï¼Œæ¨¡æ“¬ GAS å…§éƒ¨çš„ update é‚è¼¯
            // æ³¨æ„ï¼šé€™è£¡ç‚ºäº†ç°¡ä¾¿ï¼ŒGitHub é€éç¶²å€åƒæ•¸å‚³éæŒ‡ä»¤
            const url = `${GAS_URL}?action=run&func=${funcName}&unit=${encodeURIComponent(unit)}&row=${rowIdx}&val=${val}`;
            fetch(url, { mode: 'no-cors' });
            
            // ä»‹é¢å³æ™‚åæ‡‰
            setTimeout(loadVips, 500);
        }
    </script>
</body>
</html>
